ha: True
jobs_root_dir: ../../examples/advanced/cifar10/cifar10-real-world/job_configs
cleanup: False
project_yaml: ./data/projects/ha_1_servers_2_clients.yml
poll_period: 0.5


tests:
  - test_name: "run cifar10_fedavg_stream_tb_copy"
    event_sequence:
      - "trigger":
          "type": "server_log"
          "data": "Server started"
        "actions": [ "submit_job cifar10_fedavg_stream_tb_copy" ]
        "result":
          "type": "run_state"
          "data": {}
      - "trigger":
          "type": "run_state"
          "data": { "run_finished": True }
        "actions": [ "ensure_current_job_done" ]
        "result":
          "type": "run_state"
          "data": { "run_finished": True }
    validators:
      - path: tests.integration_test.validators.CIFAR10ResultValidator
    setup:
      - python convert_to_test_job.py --job ../../examples/advanced/cifar10/cifar10-real-world/job_configs/cifar10_fedavg_stream_tb --post _copy
      - python -c "from torchvision.datasets import CIFAR10; CIFAR10(root='/tmp/nvflare/cifar10', download=True)"
    teardown:
      - rm -rf ../../examples/advanced/cifar10/cifar10-real-world/job_configs/cifar10_fedavg_stream_tb_copy
